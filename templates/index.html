{% extends "base.html" %}
{% block title %}Home{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

<div class="container mt-4">
    <h1 class="text-center">MediBuddy</h1>
    <p class="text-center">
        Welcome to MediBuddy! This is your health companion platform.
    </p>

    <div class="symptom-tags-container">
        <h2>Select Your Symptoms :</h2>

        <div class="d-flex justify-content-between align-items-center mb-3">
            <input type="text" class="search-box" id="symptomSearch" placeholder="Search symptoms...">
            <div>
                <button id="selectAll" class="btn btn-primary me-2">Select All</button>
                <button id="clearAll" class="btn btn-danger">Clear All</button>
            </div>
        </div>

        <div class="symptoms-grid" id="symptomsContainer"></div>
        
        <h2>Selected Symptoms:</h2>
        <div class="selected-symptoms">
            <div id="selectedList"></div>
        </div>

        <button class="submit-btn" onclick="submitSymptoms()">Get Diagnosis</button>
    </div>

    <script>
        const symptoms = [
            'itching', 'skin_rash', 'nodal_skin_eruptions', 'continuous_sneezing', 'shivering',
            'chills', 'joint_pain', 'stomach_pain', 'acidity', 'ulcers_on_tongue',
            'muscle_wasting', 'vomiting', 'burning_micturition', 'spotting_urination', 'fatigue',
            'weight_gain', 'anxiety', 'cold_hands_and_feets', 'mood_swings', 'weight_loss',
            'restlessness', 'lethargy', 'patches_in_throat', 'irregular_sugar_level', 'cough',
            'high_fever', 'sunken_eyes', 'breathlessness', 'sweating', 'dehydration',
            'indigestion', 'headache', 'yellowish_skin', 'dark_urine', 'nausea',
            'loss_of_appetite', 'pain_behind_the_eyes', 'back_pain', 'constipation', 'abdominal_pain',
            'diarrhoea', 'mild_fever', 'yellow_urine', 'yellowing_of_eyes', 'acute_liver_failure',
            'fluid_overload', 'swelling_of_stomach', 'swelled_lymph_nodes', 'malaise',
            'blurred_and_distorted_vision', 'phlegm', 'throat_irritation', 'redness_of_eyes',
            'sinus_pressure', 'runny_nose', 'congestion', 'chest_pain', 'weakness_in_limbs',
            'fast_heart_rate', 'pain_during_bowel_movements', 'pain_in_anal_region', 'bloody_stool',
            'irritation_in_anus', 'neck_pain', 'dizziness', 'cramps', 'bruising', 'obesity',
            'swollen_legs', 'swollen_blood_vessels', 'puffy_face_and_eyes', 'enlarged_thyroid',
            'brittle_nails', 'swollen_extremeties', 'excessive_hunger', 'extra_marital_contacts',
            'drying_and_tingling_lips', 'slurred_speech', 'knee_pain', 'hip_joint_pain',
            'muscle_weakness', 'stiff_neck', 'swelling_joints', 'movement_stiffness',
            'spinning_movements', 'loss_of_balance', 'unsteadiness', 'weakness_of_one_body_side',
            'loss_of_smell', 'bladder_discomfort', 'foul_smell_of_urine', 'continuous_feel_of_urine',
            'passage_of_gases', 'internal_itching', 'toxic_look_(typhos)', 'depression',
            'irritability', 'muscle_pain', 'altered_sensorium', 'red_spots_over_body',
            'belly_pain', 'abnormal_menstruation', 'dischromic_patches', 'watering_from_eyes',
            'increased_appetite', 'polyuria', 'family_history', 'mucoid_sputum', 'rusty_sputum',
            'lack_of_concentration', 'visual_disturbances', 'receiving_blood_transfusion',
            'receiving_unsterile_injections', 'coma', 'stomach_bleeding', 'distention_of_abdomen',
            'history_of_alcohol_consumption', 'fluid_overload', 'blood_in_sputum',
            'prominent_veins_on_calf', 'palpitations', 'painful_walking', 'pus_filled_pimples',
            'blackheads', 'scurring', 'skin_peeling', 'silver_like_dusting', 'small_dents_in_nails',
            'inflammatory_nails', 'blister', 'red_sore_around_nose', 'yellow_crust_ooze'
        ];

        let selectedSymptoms = [];

        function renderSymptoms(symptomsToRender = symptoms) {
            const container = document.getElementById('symptomsContainer');
            container.innerHTML = '';
            
            symptomsToRender.forEach(symptom => {
                const tag = document.createElement('span');
                tag.className = 'tag';
                tag.textContent = symptom.replace(/_/g, ' ');
                tag.onclick = () => toggleSymptom(symptom);
                
                if (selectedSymptoms.includes(symptom)) {
                    tag.classList.add('selected');
                }
                
                container.appendChild(tag);
            });
        }

        function toggleSymptom(symptom) {
            const index = selectedSymptoms.indexOf(symptom);
            if (index > -1) {
                selectedSymptoms.splice(index, 1);
            } else {
                selectedSymptoms.push(symptom);
            }
            updateSelectedList();
            renderSymptoms();
        }

        function updateSelectedList() {
            const selectedList = document.getElementById('selectedList');
            selectedList.innerHTML = '';
            
            if (selectedSymptoms.length === 0) {
                selectedList.innerHTML = '<p>No symptoms selected</p>';
                return;
            }
            
            selectedSymptoms.forEach(symptom => {
                const span = document.createElement('span');
                span.className = 'tag selected';
                span.textContent = symptom.replace(/_/g, ' ');
                span.onclick = () => toggleSymptom(symptom);
                selectedList.appendChild(span);
            });
        }

        function submitSymptoms() {
            if (selectedSymptoms.length === 0) {
                alert('Please select at least one symptom');
                return;
            }
            
            fetch('/process_symptoms', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ symptoms: selectedSymptoms })
            })
            .then(response => response.json())
            .then(data => {
                alert('Symptoms submitted successfully!\nDiagnosis: ' + data.diagnosis);
            })
            .catch(() => {
                alert('Failed to submit symptoms.');
            });
        }

        document.getElementById('symptomSearch').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredSymptoms = symptoms.filter(symptom => 
                symptom.toLowerCase().includes(searchTerm)
            );
            renderSymptoms(filteredSymptoms);
        });

        // Select All
        document.getElementById('selectAll').addEventListener('click', () => {
            selectedSymptoms = [...symptoms];
            updateSelectedList();
            renderSymptoms();
        });

        // Clear All
        document.getElementById('clearAll').addEventListener('click', () => {
            selectedSymptoms = [];
            updateSelectedList();
            renderSymptoms();
        });

        // Initialize
        renderSymptoms();
        updateSelectedList();
    </script>
</div>
{% endblock %}